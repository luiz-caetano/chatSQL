
---

# ğŸ§  Chat SQL com LLM, Prompt Customizado e Schema Codificado

<div align="center">

![Python](https://img.shields.io/badge/Python-3.8%2B-blue?style=for-the-badge\&logo=python)
![Flask](https://img.shields.io/badge/Flask-Web%20Framework-lightgrey?style=for-the-badge\&logo=flask)
![LangChain](https://img.shields.io/badge/LangChain-Orchestration-green?style=for-the-badge)
![MySQL](https://img.shields.io/badge/MySQL-Database-orange?style=for-the-badge\&logo=mysql)
![License](https://img.shields.io/badge/License-MIT-purple?style=for-the-badge)

**IA que entende linguagem natural, gera SQL seguro e executa consultas reais usando LangChain e prompt totalmente controlado.**

[Sobre](#-sobre-o-projeto) â€¢ [Arquitetura](#-arquitetura-e-conceitos) â€¢ [Funcionalidades](#-funcionalidades) â€¢ [Tech Stack](#-tech-stack) â€¢ [InstalaÃ§Ã£o](#-instalaÃ§Ã£o) â€¢ [Exemplo](#-exemplo-de-uso)

</div>

---

## ğŸ§© Sobre o Projeto

### O Problema

UsuÃ¡rios de negÃ³cio precisam de dados **rÃ¡pidos e especÃ­ficos**, mas dependem constantemente do time tÃ©cnico para escrever queries SQL. Dashboards fixos nÃ£o resolvem perguntas dinÃ¢micas.

### A SoluÃ§Ã£o

Este projeto implementa um **chat inteligente** que:

* Converte **linguagem natural â†’ SQL**
* Usa **prompt customizado e controlado**
* Executa queries reais no banco
* Retorna dados estruturados em tempo real

Tudo isso garantindo **contexto correto do schema**, **controle da IA** e **prevenÃ§Ã£o de erros comuns**.

---

## ğŸ§  Arquitetura e Conceitos

### ğŸ” Schema do Banco em Base64

O schema do banco (**CREATE TABLE**) Ã© fornecido ao LLM **codificado em Base64**.

**Por quÃª?**

* Evita quebra de linhas e erros de parsing
* Garante consistÃªncia no prompt
* Facilita versionamento e transporte via `.env`
* Reduz risco de o modelo â€œinventarâ€ colunas

> O schema Ã© decodificado em runtime e injetado no prompt como contexto fixo.

---

### âœï¸ Prompt Customizado (Core do Projeto)

O comportamento do LLM **nÃ£o Ã© genÃ©rico**.

O prompt foi projetado para:

* Restringir a IA **somente ao schema fornecido**
* Impedir `DELETE`, `DROP`, `UPDATE`
* ForÃ§ar retorno **apenas em SQL vÃ¡lido**
* Padronizar aliases, filtros e joins

Exemplo de instruÃ§Ã£o interna:

```text
VocÃª Ã© um assistente especializado em SQL.
Use apenas as tabelas e colunas fornecidas.
Nunca invente campos.
Nunca execute comandos destrutivos.
Retorne apenas a query SQL final.
```

Isso torna o sistema:

* Mais **seguro**
* Mais **previsÃ­vel**
* Muito mais **confiÃ¡vel para produÃ§Ã£o**

---

### ğŸ¦œğŸ”— LangChain como Orquestrador

O LangChain Ã© usado para:

* Gerenciar **cadeia de prompts**
* Separar contexto (schema) da pergunta do usuÃ¡rio
* Facilitar troca de modelos (Ollama, OpenAI, etc.)
* Garantir consistÃªncia na geraÃ§Ã£o de SQL

O fluxo Ã©:

1. Pergunta do usuÃ¡rio
2. Prompt base + schema decodificado
3. LLM gera SQL
4. SQL Ã© validado
5. Query executada no banco
6. Resultado retornado ao frontend

---

## âœ¨ Funcionalidades

âœ” ConversÃ£o de linguagem natural em SQL
âœ” Prompt totalmente controlado
âœ” Schema fixo e seguro (Base64)
âœ” ExecuÃ§Ã£o real no banco MySQL
âœ” Retorno dos dados + query gerada
âœ” Interface web simples e responsiva

---

## ğŸ§ª Tech Stack

| Camada   | Tecnologia         | FunÃ§Ã£o                        |
| -------- | ------------------ | ----------------------------- |
| Backend  | Python + Flask     | API e controle da aplicaÃ§Ã£o   |
| IA       | LangChain + LLM    | OrquestraÃ§Ã£o e geraÃ§Ã£o de SQL |
| Database | MySQL              | Fonte de dados                |
| Frontend | Bootstrap + Jinja2 | Interface web                 |

---

## ğŸš€ InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### PrÃ©-requisitos

* Python 3.8+
* MySQL rodando
* Ollama ou outro LLM compatÃ­vel

### Passos

1. **Clone o repositÃ³rio**

```bash
git clone https://github.com/seu-usuario/seu-repo.git
cd seu-repo
```

2. **Instale dependÃªncias**

```bash
pip install -r requirements.txt
```

3. **Configure o `.env`**

```ini
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=sua_senha
DB_NAME=seu_banco

# Schema do banco codificado em Base64
SCHEMA_BASE64=Q1JFQVRFIFRBQkxFIHZlbmRhcyAoLi4uKTs=
```

> ğŸ’¡ Dica:
> `cat schema.sql | base64`

4. **Execute**

```bash
python main.py
```

5. **Acesse**

```
http://localhost:5000/chat
```

---

## ğŸ§  Exemplo de Uso

**UsuÃ¡rio:**

> â€œQuais foram as vendas do produto AVERT em Varginha?â€

**SQL Gerado:**

```sql
SELECT cliente, valor_total
FROM vendas
WHERE produto = 'AVERT'
AND cidade = 'Varginha';
```

**Resultado:**

```json
[
  { "cliente": "FarmÃ¡cia Central", "valor_total": 1250.00 },
  { "cliente": "Hospital Vida", "valor_total": 3400.50 }
]
```

---

## ğŸ“ Estrutura do Projeto

```bash
.
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ views.py
â”‚   â”œâ”€â”€ llm.py        # Prompt + LangChain
â”‚   â”œâ”€â”€ templates/
â”‚   â””â”€â”€ static/
â””â”€â”€ README.md
```

---

## ğŸ‘¨â€ğŸ’» Autor

**Luiz Caetano**
*Software Developer | Backend | IA aplicada a dados*

ğŸ”¹ Python â€¢ SQL â€¢ LangChain â€¢ LLMs
ğŸ”¹ AutomaÃ§Ã£o e inteligÃªncia aplicada a negÃ³cios

[LinkedIn](https://www.linkedin.com/in/luiz-caetano)

---

